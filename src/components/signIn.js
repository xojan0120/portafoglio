// -------------------------------------------------------------------------------------------------
// * Import Modules(React Standard)
// -------------------------------------------------------------------------------------------------
import React from 'react';

// -------------------------------------------------------------------------------------------------
// * Import Modules(Self Made)
// -------------------------------------------------------------------------------------------------
import * as Api from '../lib/api';

// -------------------------------------------------------------------------------------------------
// * Import Modules(Firebase)
// -------------------------------------------------------------------------------------------------
import './firebase/loading.css';
import * as FirebaseAuth from './firebase/firebaseAuth';

// ----------------------------------------------------------------------------------------
// * Main Class
// ----------------------------------------------------------------------------------------
class SignIn extends React.Component {
  // --------------------------------------------------------------------------------------
  // * Lifecycle Methods
  // --------------------------------------------------------------------------------------
  componentDidMount = () => {
    FirebaseAuth.uiShow(successCallback);
  }

  // --------------------------------------------------------------------------------------
  // Render Methods
  // --------------------------------------------------------------------------------------
  render() {
    return (
      <div id="firebaseui-auth-container"></div>
    );
  }
}

const successCallback = (authResult, redirectUrl) => {
  authResult.user.getIdToken(true)
    .then (token => {
      //if (authResult.additionalUserInfo.isNewUser) {  
        Api.createAccount(token, authResult.user.uid);
      //}
    })
    .catch(error => console.log(`Firebase get token failed!: ${error.message}`))
    .finally(() => window.location.pathname = '/');
}

// --------------------------------------------------------------------------------------
// Export Module
// --------------------------------------------------------------------------------------
export default SignIn;
